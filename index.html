<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Turing Autoformat</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">

    <style>
    html,body,div,dd,dl,ul,ol,li,button,textarea,pre,code,a{box-sizing:border-box;padding:0;margin:0;}
    body {
        font: 1em/1.5 Lato, 'Helvetica Neue', HelveticaNeue, Helvetica, Arial, sans-serif;
    }

    .full-width > * {
        width: 100%;
    }
    .full-height > * {
        height: 100%;
    }
    .wrapper {
        display: inline-block;
        float: left;
        width: 50%;
        height: 100%;
        padding: 0;
    }
    .clear {
        clear: both; 
    }
    pre {
        overflow: auto;
    }
    .input, .output {
        height: calc(100vh - 7em);
        padding: 1em;
    }
    .options-wrapper {
        height: 7em;
        padding: 1em;
    }
    .flags {
        width: calc(50% - 6em);
    }
    .btn {
        width: 6em;
        height: 100%;
        background-color: red;
        color: white;
        border: 1px solid black;
    }
    </style>
</head>
<body>
    <main>
        <div class="full-width full-height input wrapper">
            <textarea id="input"></textarea>
        </div>
        <div class="full-width full-height output wrapper">
            <pre><code id="output"></code></pre>
        </div>
        <div class="clear"></div>
        <div class="options-wrapper">
            <div class="formatters wrapper">
                <label>
                    <input type="checkbox" class="formatter" name="format" checked>
                    Use all formatters
                </label>
                <hr>
                <dd class="wrapper">
                    <dl>
                        <label>
                            <input type="checkbox" class="formatter" name="formatComments" data-disabled="format" checked disabled>
                            Format comments
                        </label>
                    </dl>
                    <dl>
                        <label>
                            <input type="checkbox" class="formatter" name="formatConsts" data-disabled="format" checked disabled>
                            Format constant names
                        </label>
                    </dl>
                </dd>
                <dd class="wrapper">
                    <dl>
                        <label>
                            <input type="checkbox" class="formatter" name="formatVars" data-disabled="format" checked disabled>
                            Format variable names
                        </label>
                    </dl>
                    <dl>
                        <label>
                            <input type="checkbox" class="formatter" name="formatBoolFuncs" data-disabled="format" checked disabled>
                            Format boolean function names
                        </label>
                    </dl>
                </dd>
            </div>
            <div class="flags wrapper">
                <dd>
                    <dl>
                    <label>
                        <input type="checkbox" class="flag" name="lowerCaseVariables">
                        Format variable names as lower_case, not camelCase
                    </label>
                </dl>
                <dl>
                    <label>
                        <input type="checkbox" class="flag" name="sentenceCasePointers" data-disabled="lowerCaseVariables">
                        Format pointer names in SentenceCase, not camelCase
                    </label>
                    </dl>
                </dd>
            </div>
            <button class="btn wrapper" id="go" href="#">
                Go
            </button>
        </div>
    </main>

    <script src="./dist/format.js"></script>

    <script>
    (function () {
        var $ = document.querySelector.bind(document),
            $$ = document.querySelectorAll.bind(document),
            disabled = {},
            flags = {},
            formatters = [];

        var onChangeHandler = function () {
            var name = this.getAttribute('name');
            if (disabled.hasOwnProperty(name)) {
                for (var i in disabled[name]) {
                    $("[name='" + disabled[name][i] + "']").disabled = !$("[name='" + disabled[name][i] + "']").disabled;
                }
            }
            
            if (this.classList.contains("flag")) {
                flags[name] = this.checked;
            } else if (this.classList.contains("formatter") && name !== "format") {
                if (this.checked) {
                    formatters.push(name);
                } else {
                    formatters.splice(formatters.indexOf(name), 1);
                }
            }
        };

        var checkboxes = $$("[type='checkbox']")
        for (var c in checkboxes) {
            if (checkboxes.hasOwnProperty(c)) {
                var checkbox = checkboxes[c],
                    name = checkbox.getAttribute('name');
                
                if (checkbox.hasAttribute('data-disabled')) {
                    var disablers = checkbox.getAttribute('data-disabled').split(' ');
                    
                    disablers.forEach(function (d) {
                        if (Array.isArray(disabled[d])) {
                            disabled[d].push(name);
                        } else {
                            disabled[d] = [name];
                        }
                    });
                }
                
                if (checkbox.classList.contains('flag')) {
                    flags[name] = checkbox.checked;
                } else if (checkbox.classList.contains('formatter') && checkbox.checked && name !== "format") {
                    formatters.push(name);
                }
                
                checkbox.addEventListener('change', onChangeHandler.bind(checkbox), false);
            }
        }
        
        $('#go').addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            
            var input = $('#input').value,
                format = TuringAutoformat(flags);

            if ($("[name='format']").checked) {
                input = format.format(input);
            } else {
                for (var f in formatters) {
                    input = format[formatters[f]].call(this, input);
                }
            }
            
            $('#output').textContent = input;
        }, false);
    })();
    </script>
</body>
</html>
